<!DOCTYPE html>
<html lang="en" th:replace="~{base :: layout(content=~{::#content}, title=~{::#title}, script=~{::#script}, banner=~{::#banner})}">
<head>
    <title id="title">Encrypted Export - Data Manager</title>
    <th:block id="script">
        <script>
            console.log("In Export Key Page");
            function copyKey() {
                const keyText = document.getElementById('exportKey').textContent;
                navigator.clipboard.writeText(keyText).then(function() {
                    const copyBtn = document.getElementById('copyBtn');
                    const originalText = copyBtn.innerHTML;
                    copyBtn.innerHTML = '<i class="fas fa-check mr-2"></i>Copied!';
                    copyBtn.classList.remove('bg-gray-600', 'hover:bg-gray-700');
                    copyBtn.classList.add('bg-green-600');
                    setTimeout(function() {
                        copyBtn.innerHTML = originalText;
                        copyBtn.classList.remove('bg-green-600');
                        copyBtn.classList.add('bg-gray-600', 'hover:bg-gray-700');
                    }, 2000);
                }).catch(function(err) {
                    alert('Failed to copy key: ' + err);
                });
            }
        </script>
    </th:block>
</head>
<body>
    <th:block id="banner" th:replace="~{fragments/banner :: simple('Encrypted Export', 'Secure your contact data with encryption')}"></th:block>

    <div id="content" class="py-12">
        <div th:fragment="content" class="max-w-3xl mx-auto px-4">
            <div class="mb-6">
                <a th:href="@{/user/contacts}" class="text-blue-600 hover:text-blue-700 font-medium">
                    <i class="fas fa-arrow-left mr-2"></i>Back to Contacts
                </a>
            </div>

            <div class="bg-white p-8 rounded-lg shadow-lg border border-gray-200 mb-6">
                <div class="text-center mb-8">
                    <div class="w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-key text-blue-600 text-3xl"></i>
                    </div>
                    <h2 class="text-2xl font-semibold text-gray-800 mb-2">Your Encryption Key</h2>
                    <p class="text-gray-600">Save this key securely - you'll need it to decrypt your contacts</p>
                </div>

                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-blue-300 rounded-lg p-6 mb-6">
                    <div class="flex items-center justify-between">
                        <div class="flex-1">
                            <p class="text-sm text-gray-600 mb-2">Encryption Key:</p>
                            <p id="exportKey" th:text="${exportKey}" class="text-3xl font-mono font-bold text-blue-900 tracking-wider">12345678</p>
                        </div>
                        <button onclick="copyKey()" id="copyBtn" class="ml-4 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors">
                            <i class="fas fa-copy mr-2"></i>Copy
                        </button>
                    </div>
                </div>

                <div class="bg-red-50 border-l-4 border-red-500 p-4 mb-6">
                    <div class="flex items-start">
                        <i class="fas fa-exclamation-triangle text-red-500 text-xl mr-3 mt-1"></i>
                        <div>
                            <h3 class="font-semibold text-red-800 mb-2">Important Security Notice</h3>
                            <ul class="text-sm text-red-700 space-y-1">
                                <li>• This key will only be shown once</li>
                                <li>• Write it down or save it in a secure password manager</li>
                                <li>• Without this key, you cannot decrypt your exported contacts</li>
                                <li>• Do not share this key with anyone</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="text-center">
                    <a th:href="@{/user/contacts/export/download-encrypted}" class="inline-block px-8 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold text-lg">
                        <i class="fas fa-download mr-2"></i>Download Encrypted File
                    </a>
                    <p class="text-sm text-gray-500 mt-3">File will be saved as: contacts.csv.enc</p>
                </div>
            </div>

            <div class="bg-blue-50 p-6 rounded-lg border border-blue-200">
                <h3 class="text-lg font-semibold text-blue-900 mb-4"><i class="fas fa-info-circle mr-2"></i>How to Use Encrypted Export</h3>
                <div class="space-y-3 text-blue-800 text-sm">
                    <div class="flex items-start">
                        <span class="bg-blue-600 text-white rounded-full w-6 h-6 flex items-center justify-center mr-3 flex-shrink-0 mt-0.5">1</span>
                        <p><strong>Copy or save your encryption key</strong> - You'll need this to decrypt the file later</p>
                    </div>
                    <div class="flex items-start">
                        <span class="bg-blue-600 text-white rounded-full w-6 h-6 flex items-center justify-center mr-3 flex-shrink-0 mt-0.5">2</span>
                        <p><strong>Click "Download Encrypted File"</strong> - Your contacts will be downloaded as an encrypted file</p>
                    </div>
                    <div class="flex items-start">
                        <span class="bg-blue-600 text-white rounded-full w-6 h-6 flex items-center justify-center mr-3 flex-shrink-0 mt-0.5">3</span>
                        <p><strong>Store the file securely</strong> - The encrypted file can be safely stored in cloud storage or sent via email</p>
                    </div>
                </div>
            </div>

            <div class="mt-6 text-center">
                <p class="text-gray-600 mb-3">Need an unencrypted export?</p>
                <a th:href="@{/user/contacts/export}" class="text-blue-600 hover:text-blue-700 font-medium">
                    <i class="fas fa-file-csv mr-2"></i>Download as plain CSV instead
                </a>
            </div>
        </div>
    </div>
</body>
</html>
